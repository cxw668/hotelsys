## 1. 实验方案
一、实验目标
搭建 Spring Boot 轻量级后端框架，实现与 MySQL 数据库的稳定连接；
完成客房管理、经营数据统计核心表的基础 CRUD 接口开发，遵循 RESTful 规范；
实现接口统一返回格式，完成基础接口测试，保障数据交互准确性。
二、实验环境
开发工具：IntelliJ IDEA
开发语言：Java 21
核心框架：Spring Boot 2.7.x、MyBatis-Plus 3.5.x
数据库：MySQL 8.0.x
依赖管理：Maven 3.6+
辅助工具：Postman（接口测试）
三、实验步骤
项目初始化：通过 Spring Initializr 创建项目，勾选 Spring Web、MyBatis-Plus、MySQL Driver、Lombok 核心依赖，完成项目基础结构搭建；
数据库配置：在 application.yml 配置文件中编写 MySQL 连接信息，配置 MyBatis-Plus 下划线转驼峰、Mapper 文件路径等核心参数；
数据库建表：创建 hims_db 数据库，编写客房基础信息、经营数据统计两张核心表的建表语句，完成数据库初始化；
核心代码开发：按 Entity→Mapper→Service→Controller 层级开发，实现客房信息查询、房态修改、经营数据新增 / 查询核心业务逻辑；
接口优化：编写自定义统一返回类，添加 @CrossOrigin 注解解决跨域问题，规范接口请求与返回格式；
接口测试：启动后端服务，使用 Postman 调用所有核心接口，验证接口返回状态、数据与数据库同步性，修复接口问题。
四、实验验证标准
后端服务启动无报错，MySQL 数据库连接正常，无配置异常；
所有核心接口返回状态码 200，请求参数与返回数据格式符合 RESTful 规范；
房态修改、数据新增等操作可同步更新数据库，查询接口返回数据与数据库一致；
跨域请求可正常响应，统一返回格式生效，异常请求有明确提示信息。

## 2. 数据库设计

### 1. 数据库基本信息

- 数据库名称：`hims_db`
- 字符集：`utf8mb4`（兼容emoji，适配中文）
- 排序规则：`utf8mb4_general_ci`
- 数据库版本：MySQL 8.0.x

### 2. 核心表结构设计

#### （1）客房基础信息表（room_info）

| 字段名      | 数据类型    | 主键/非空 | 默认值                                        | 注释                       |
| ----------- | ----------- | --------- | --------------------------------------------- | -------------------------- |
| id          | BIGINT      | 主键/自增 | -                                             | 主键ID                     |
| room_num    | VARCHAR(10) | 非空      | -                                             | 房间号（如：101、205）     |
| room_type   | VARCHAR(20) | 非空      | 单人间                                        | 房型（单人间/双人间/套房） |
| room_status | TINYINT     | 非空      | 0                                             | 房态：0-空闲 1-入住 2-维修 |
| create_time | DATETIME    | -         | CURRENT_TIMESTAMP                             | 记录创建时间               |
| update_time | DATETIME    | -         | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 记录更新时间               |

#### （2）经营数据统计表（business_stats）

| 字段名       | 数据类型      | 主键/非空 | 默认值            | 注释                       |
| ------------ | ------------- | --------- | ----------------- | -------------------------- |
| id           | BIGINT        | 主键/自增 | -                 | 主键ID                     |
| stat_date    | DATE          | 非空      | -                 | 统计日期（如：2026-02-07） |
| check_in_num | INT           | 非空      | 0                 | 当日入住房间数             |
| revenue      | DECIMAL(10,2) | 非空      | 0.00              | 当日营收（单位：元）       |
| create_time  | DATETIME      | -         | CURRENT_TIMESTAMP | 记录创建时间               |

### 3. 索引设计（最小优化）

- `room_info`表：为 `room_num`创建唯一索引（UNIQUE），避免重复房间号；
- `business_stats`表：为 `stat_date`创建普通索引（INDEX），提升按日期查询效率。


## 3. 接口文档
### 1. 接口基础信息

- 接口前缀：`http://localhost:8080/api`
- 请求方式：GET（查询）、POST（新增/修改）
- 统一返回格式：

```json
{
  "code": 200, // 状态码：200-成功 500-失败
  "msg": "操作成功", // 提示信息
  "data": {} // 返回数据（按需返回）
}
```

### 2. 客房管理接口

#### （1）查询所有客房信息

- 接口路径：`/room/list`
- 请求方式：GET
- 请求参数：无
- 返回示例：

```json
{
  "code": 200,
  "msg": "查询成功",
  "data": [
    {
      "id": 1,
      "roomNum": "101",
      "roomType": "单人间",
      "roomStatus": 0,
      "createTime": "2026-02-07 10:00:00",
      "updateTime": "2026-02-07 10:00:00"
    }
  ]
}
```

#### （2）修改客房状态

- 接口路径：`/room/updateStatus`
- 请求方式：POST
- 请求参数（JSON）：

```json
{
  "id": 1, // 客房ID
  "roomStatus": 1 // 目标房态：0-空闲 1-入住 2-维修
}
```

- 返回示例：

```json
{
  "code": 200,
  "msg": "房态修改成功",
  "data": null
}
```

### 3. 经营数据统计接口

#### （1）查询指定日期经营数据

- 接口路径：`/stats/queryByDate`
- 请求方式：GET
- 请求参数（URL传参）：`date=2026-02-07`（统计日期）
- 返回示例：

```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "id": 1,
    "statDate": "2026-02-07",
    "checkInNum": 15,
    "revenue": 3800.00,
    "createTime": "2026-02-07 23:59:59"
  }
}
```

#### （2）新增/更新经营数据

- 接口路径：`/stats/saveOrUpdate`
- 请求方式：POST
- 请求参数（JSON）：

```json
{
  "statDate": "2026-02-07", // 统计日期
  "checkInNum": 15, // 入住数
  "revenue": 3800.00 // 营收
}
```

- 返回示例：

```json
{
  "code": 200,
  "msg": "数据保存成功",
  "data": null
}
```

#### （3）查询近7天经营数据（可视化专用）

- 接口路径：`/stats/queryRecent7Days`
- 请求方式：GET
- 请求参数：无
- 返回示例：

```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "dates": ["2026-02-01", "2026-02-02", ..., "2026-02-07"],
    "checkInNums": [10, 12, 8, 15, 18, 11, 15],
    "revenues": [2500.00, 2800.00, 2000.00, 3800.00, 4200.00, 2900.00, 3800.00]
  }
}
```