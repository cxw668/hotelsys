## 1. 实验方案
一、实验目标
搭建 Spring Boot 轻量级后端框架，实现与 MySQL 数据库的稳定连接；
完成客房管理、经营数据统计核心表的基础 CRUD 接口开发，遵循 RESTful 规范；
实现接口统一返回格式，完成基础接口测试，保障数据交互准确性。
二、实验环境
开发工具：IntelliJ IDEA
开发语言：Java 21
核心框架：Spring Boot 3.4.x、MyBatis-Plus 3.5.x
数据库：MySQL 8.0.x
依赖管理：Maven 3.6+
辅助工具：Postman（接口测试）
三、实验步骤
项目初始化：通过 Spring Initializr 创建项目，勾选 Spring Web、MyBatis-Plus、MySQL Driver、Lombok 核心依赖，完成项目基础结构搭建；
数据库配置：在 application.properties 配置文件中编写 MySQL 连接信息，配置 MyBatis-Plus 下划线转驼峰、Mapper 文件路径等核心参数；
数据库建表：创建 hims_db 数据库，编写客房基础信息、经营数据统计两张核心表的建表语句，完成数据库初始化；
核心代码开发：按 Entity→Mapper→Service→Controller 层级开发，实现客房信息查询、房态修改、经营数据新增 / 查询核心业务逻辑；
接口优化：编写自定义统一返回类，添加 @CrossOrigin 注解解决跨域问题，规范接口请求与返回格式；
接口测试：启动后端服务，使用 Postman 调用所有核心接口，验证接口返回状态、数据与数据库同步性，修复接口问题。
四、实验验证标准
后端服务启动无报错，MySQL 数据库连接正常，无配置异常；
所有核心接口返回状态码 200，请求参数与返回数据格式符合 RESTful 规范；
房态修改、数据新增等操作可同步更新数据库，查询接口返回数据与数据库一致；
跨域请求可正常响应，统一返回格式生效，异常请求有明确提示信息。

## 2. 数据库设计

### 1. 数据库基本信息

- 数据库名称：`hims_db`
- 字符集：`utf8mb4`（兼容emoji，适配中文）
- 排序规则：`utf8mb4_general_ci`
- 数据库版本：MySQL 8.0.x

### 2. 核心表结构设计

#### （1）客房基础信息表（room_info）

| 字段名      | 数据类型    | 主键/非空 | 默认值                                        | 注释                       |
| ----------- | ----------- | --------- | --------------------------------------------- | -------------------------- |
| id          | BIGINT      | 主键/自增 | -                                             | 主键ID                     |
| room_num    | VARCHAR(10) | 非空      | -                                             | 房间号（如：101、205）     |
| room_type   | VARCHAR(20) | 非空      | 单人间                                        | 房型（单人间/双人间/套房） |
| room_status | TINYINT     | 非空      | 0                                             | 房态：0-空闲 1-入住 2-维修 |
| create_time | DATETIME    | -         | CURRENT_TIMESTAMP                             | 记录创建时间               |
| update_time | DATETIME    | -         | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 记录更新时间               |

```sql
-- 客房基础信息表（room_info）
CREATE TABLE room_info (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    room_num VARCHAR(10) NOT NULL COMMENT '房间号（如：101、205）',
    room_type VARCHAR(20) NOT NULL DEFAULT '单人间' COMMENT '房型（单人间/双人间/套房）',
    room_status TINYINT NOT NULL DEFAULT 0 COMMENT '房态：0-空闲 1-入住 2-维修',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '记录创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '记录更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='客房基础信息表';
```

#### （2）经营数据统计表（business_stats）

| 字段名       | 数据类型      | 主键/非空 | 默认值            | 注释                       |
| ------------ | ------------- | --------- | ----------------- | -------------------------- |
| id           | BIGINT        | 主键/自增 | -                 | 主键ID                     |
| stat_date    | DATE          | 非空      | -                 | 统计日期（如：2026-02-07） |
| check_in_num | INT           | 非空      | 0                 | 当日入住房间数             |
| revenue      | DECIMAL(10,2) | 非空      | 0.00              | 当日营收（单位：元）       |
| create_time  | DATETIME      | -         | CURRENT_TIMESTAMP | 记录创建时间               |
| update_time  | DATETIME      | -         | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 记录更新时间               |

```sql
-- 经营数据统计表（business_stats）
CREATE TABLE business_stats (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    stat_date DATE NOT NULL COMMENT '统计日期（如：2026-02-07）',
    check_in_num INT NOT NULL DEFAULT 0 COMMENT '当日入住房间数',
    revenue DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT '当日营收（单位：元）',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '记录创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '记录更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='经营数据统计表';
```

### 3. 索引设计（最小优化）

- `room_info`表：为 `room_num`创建唯一索引（UNIQUE），避免重复房间号；
- `business_stats`表：为 `stat_date`创建普通索引（INDEX），提升按日期查询效率。

how to do?
- 为 `room_num`创建唯一索引：`ALTER TABLE room_info ADD UNIQUE INDEX idx_room_num (room_num);`
- 为 `stat_date`创建普通索引：`ALTER TABLE business_stats ADD INDEX idx_stat_date (stat_date);`



## 3. 接口文档
### 1. 接口基础信息（统一规范）

- 接口前缀：`http://localhost:8080/api`
- 风格：RESTful，路径使用小写与短横线（kebab-case），不在 URL 中出现动词
- 方法语义：GET 查询、POST 创建、PATCH 部分更新、DELETE 删除
- 请求体：统一使用 JSON；明确区分 path / query / body 参数；时间字段使用 ISO 8601（UTC）
- 统一响应结构：

```json
{
  "code": 0,
  "message": "操作成功",
  "data": {}
}
```

### 2. 客房管理接口（rooms）

- GET `/rooms`：查询所有客房
- GET `/rooms/{id}`：查询单个客房
- POST `/rooms`：创建客房
- PATCH `/rooms/{id}`：部分更新客房（示例：房态）
- DELETE `/rooms/{id}`：删除客房

示例请求（PATCH 更新房态，body）

```json
{
  "roomStatus": 1
}
```

### 3. 经营数据统计接口（stats）

- GET `/stats`：按 `query` 参数过滤（如 `date=YYYY-MM-DD`）
- GET `/stats/{id}`：查询单条统计
- POST `/stats`：创建统计数据
- PATCH `/stats/{id}`：更新统计数据
- DELETE `/stats/{id}`：删除统计数据
- GET `/stats/recent-7-days`：查询近 7 天统计（用于可视化）

示例请求（POST 创建，body）

```json
{
  "statDate": "2026-02-07",
  "checkInNum": 15,
  "revenue": 3800.00
}
```

示例响应（统一结构）

```json
{
  "code": 0,
  "message": "操作成功",
  "data": null
}
```

### 4. 新增模块接口清单

以下模块均采用统一的 RESTful 资源路径与方法，支持基础 CRUD：

- 客房预订（reservations）：`/reservations`
- 客户信息管理（customers）：`/customers`
- 订单管理（orders）：`/orders`
- 员工管理（employees）：`/employees`
- 价格策略管理（pricing-policies）：`/pricing-policies`
- 退房结算（checkouts）：`/checkouts`
- 客房清洁状态（room-cleaning-statuses）：`/room-cleaning-statuses`
- 投诉报修（complaints）：`/complaints`
- 库存物资管理（inventories）：`/inventories`
- 会员管理（memberships）：`/memberships`

每个资源均提供：

- GET `/resource`：列表查询（支持 query 参数）
- GET `/resource/{id}`：详情查询
- POST `/resource`：创建资源
- PATCH `/resource/{id}`：部分更新资源
- DELETE `/resource/{id}`：删除资源

示例响应结构统一为：

```json
{
  "code": 0,
  "message": "操作成功",
  "data": {}
}
```
